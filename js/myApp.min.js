var map,googleMapsAPIKey="AIzaSyC-Dviv1NRrCTrwrYKCX8oRFlsFHtHZGPo",googleSVURL="https://maps.googleapis.com/maps/api/streetview",centerLat=39.7392358,centerLng=-104.990251,today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm);var version=yyyy+mm+dd,foursquareCID="U01MV3QZTBA4KBUTEZZHJLLRLFESIEW1NLTMS25T0NTHRECR",foursquareSecret="2YGSGTO1ZFXPMNBFJAFJI0BW5XZF2I3XXCTDQ1D4ODQVUQRP",foursquareAPI="https://api.foursquare.com/v2/venues/search?client_id="+foursquareCID+"&client_secret="+foursquareSecret+"&v="+version;function alphaName(){allBookstores.sort(function(e,o){var a=e.name.toLowerCase(),t=o.name.toLowerCase();return a<t?-1:a>t?1:0})}alphaName();var Place=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.location.lat),this.lng=ko.observable(e.location.lng),this.type=ko.observable(e.type),this.marker=ko.observable()},viewModel=function(){var e,o=this;o.bookstoreList=ko.observableArray([]),o.visibleBS=ko.observableArray(),allBookstores.forEach(function(e){o.bookstoreList.push(new Place(e))});var a=new google.maps.InfoWindow({maxWidth:275});o.bookstoreList().forEach(function(t){e=new google.maps.Marker({position:new google.maps.LatLng(t.lat(),t.lng()),map:map,animation:google.maps.Animation.DROP}),t.marker=e;var n=foursquareAPI+"&ll="+t.lat()+","+t.lng()+"&query='"+encodeURIComponent(t.name())+"'&limit=1",r="",i="",s=!1,l='<a href="https://www.google.com/maps/dir/Current+Location/'+t.lat()+","+t.lng()+'" target="_blank" title="Driving Directions"><span class="fas fa-car mt-2 mb-2"></span></a>',m="";$.getJSON(n,function(e){var o,a,n,m,c=e.response.venues[0],u="",p="",g="",d="";o=c.location.address,a=c.location.city,n=c.location.state,m=c.location.postalCode,p=c.contact.formattedPhone,g=c.location.lat,d=c.location.lng,void 0===g&&(g=t.lat()),void 0===d&&(d=t.lng()),u=void 0!==o&&void 0!==a&&void 0!==n&&void 0!==m?o+"<br>"+a+", "+n+" "+m:"Book store address missing information or not found.",void 0===p&&(p="Book store phone number was not found."),r=u+"<br>"+p+l+"<br>";var v=googleSVURL+"/metadata?location="+g+","+d+"&key="+googleMapsAPIKey;$.getJSON(v,function(e){"OK"===e.status&&(i='<p><img src="'+googleSVURL+"?location="+g+","+d+"&size=225x100&key="+googleMapsAPIKey+'"></p>'),s=!0}).done(function(){}).fail(function(){s=!1}).always(function(){})}).done(function(){}).fail(function(){r="<p>Data could not be retrieved from Foursquare.</p>",s=!1}).always(function(){}),google.maps.event.addListener(t.marker,"click",function(){s&&(m='<small><em>Bookstore address and phone number were provided by <a href="https://foursquare.com" target="_blank">Foursquare</a></em>.</small>'),""===r&&(r=l);var e="<div><h4>"+t.name()+" <em><small>"+t.type()+"</small></em></h4>"+i+"<p>"+r+m+"</p></div>";null!==t.marker.getAnimation()?t.marker.setAnimation(null):(t.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.marker.setAnimation(null)},1e3)),a.setContent(e),a.open(map,t.marker)}),o.showBsInfo=function(e){google.maps.event.trigger(e.marker,"click")},o.visibleBS.push(t)}),o.userInput=ko.observable(""),o.filterBookstores=function(){var e=o.userInput().toLowerCase();o.visibleBS.removeAll(),a.close(),o.bookstoreList().forEach(function(a){a.marker.setVisible(!1),-1!==a.name().toLowerCase().indexOf(e)&&o.visibleBS.push(a)}),o.visibleBS().forEach(function(e){e.marker.setVisible(!0)})},o.filterButton=function(e){o.visibleBS.removeAll(),a.close(),o.clearSearchBox(),o.bookstoreList().forEach(function(a){a.marker.setVisible(!1),a.type()===e?o.visibleBS.push(a):"All"===e&&o.visibleBS.push(a)}),o.visibleBS().forEach(function(e){e.marker.setVisible(!0)})},o.clearSearchBox=function(){o.userInput("")},o.clearFilter=function(){o.clearSearchBox(),o.visibleBS.removeAll(),a.close(),o.bookstoreList().forEach(function(e){e.marker.setVisible(!0),o.visibleBS.push(e)})}};function initMap(){"use strict";map=new google.maps.Map(document.getElementById("map"),{center:new google.maps.LatLng(centerLat,centerLng),zoom:10,zoomControl:!0,scaleControl:!0,mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,mapTypeIds:["roadmap","terrain","hybrid","satellite"]}}),google.maps.event.addDomListener(window,"resize",function(){var e=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(e)}),ko.applyBindings(new viewModel)}function googleAPIError(){alert("Google Maps could not load. Please check your internet connection and try again.")}